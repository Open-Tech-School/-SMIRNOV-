from aiogram import types, Bot, Dispatcher
from aiogram.dispatcher import FSMContext
from aiogram.contrib.fsm_storage.memory import MemoryStorage
from aiogram.dispatcher.filters import Command
from module import config, keyboard, logger, database
from aiogram.dispatcher.filters.state import State, StatesGroup
import random
import datetime

bd = database.BASEDATA()
bot = Bot(token=config.api_key)

class Create_Item_Attractions(StatesGroup):
    name = State()
    url_google_maps = State()
    descriptions = State()
    picture = State()

# ["Welcome"] ==============================================

async def welcome(msg: types.Message):
    if bd.find_user(id=msg.from_user.id).fetchone() is None:
        bd.create_user(msg.from_user.username, msg.from_user.id, '–ù–∞—á–∏–Ω–∞—é—â–∏–π –∏—Å—Ç–æ—Ä–∏–∫', datetime.datetime.now())
    await msg.answer('''
<code>üìë –ë–æ—Ç –ú–∞—Ä–µ—Å–µ–µ–≤–∏—á / –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</code>

üìå –¢—ã –ø–æ–ø–∞–ª –≤ –≥–æ—Å—Ç–∏ –∫ –ú–∞—Ä–µ—Å–µ–µ–≤–∏—á—É üõï
‚ö°Ô∏è –ó–¥–µ—Å—å –≤—ã,–º–æ–ª–æ–¥—ã–µ –∏—Å—Ç–æ—Ä–∏–∫–∏, –º–æ–∂–µ—Ç–µ –∏–∑—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –•–∞–±–∞—Ä–æ–≤—Å–∫–æ–≥–æ –∫—Ä–∞—è! 
üë®üèª‚Äçüíª –¢–µ—Ö.–ü–æ–¥–¥–µ—Ä–∂–∫–∞ - @raizyxadev

–£–¥–∞—á–Ω—ã—Ö –≤–∞–º –Ω–æ–≤—ã—Ö –æ—Ç–∫—Ä—ã—Ç–∏–π –∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π!
    
    ''',reply_markup = keyboard.startbutton())


# ["Attraction City"] ==============================================

async def attractioncity(message):
    await message.answer('–≠–ú')
    
# ["F.A.Q"] ==============================================

async def faqinfo(message):
    await message.answer('''
<code>üìë –ë–æ—Ç –ú–∞—Ä–µ—Å–µ–µ–≤–∏—á / F.A.Q –ø—Ä–æ–µ–∫—Ç–∞</code>

1. <b> –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–µ–∫—Ç? </b>
- –ü—Ä–æ–µ–∫—Ç - —ç—Ç–æ —Å–æ–≤–æ–∫—É–ø–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ü–µ–ª–∏ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Å—Ä–æ–∫.

2. <b> –ö–∞–∫–∏–µ —Ü–µ–ª–∏ —Å—Ç–∞–≤–∏—Ç –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π –Ω–∞—à –ø—Ä–æ–µ–∫—Ç? </b>
- –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞: —É–ª—É—á—à–µ–Ω–∏–µ –∏ —É–ø—Ä–æ—â–µ–Ω–∏–µ –∏–∑—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –•–∞–±–∞—Ä–æ–≤—Å–∫–∏–º –∫—Ä–∞–µ–º.–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è —Å –∏—Å—Ç–æ—Ä–∏–µ–π —Å–≤–æ–∏—Ö –ø—Ä–µ–¥–∫–æ–≤ –∏ —Å–≤–æ–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞.

3. <b> –ö–∞–∫–æ–≤—ã –æ—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã –ø—Ä–æ–µ–∫—Ç–∞? </b>
- –û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ —á–∞—Ç-–±–æ—Ç–∞ —Å –∏—Å—Å–∫—É—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º,—Å–ø–æ—Å–æ–±–Ω–æ–≥–æ –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å –≤–∞–º –ª—é–±–æ–π  

4. <b> –ö–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ? </b>
- –í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º, —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π, —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ –∏ —Ç.–¥
    ''')
# [–ü—É–Ω–∫—Ç –º–µ–Ω—é "–ü–æ–¥–¥–µ—Ä–∂–∫–∞"] ==============================================

async def supportOpen(message):
    await message.answer('''
<code>üìë –ë–æ—Ç –ú–∞—Ä–µ—Å–µ–µ–≤–∏—á / –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ü–æ–¥–¥–µ—Ä–∂–∫–∞</code>

–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π,
—á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å: –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞,–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –±–∞–≥–æ–≤ –∏ —Ç–¥

<b>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</b> ¬ª @raizyxadev
''')

# [–ü—Ä–æ—Ñ–∏–ª—å —é–∑–µ—Ä–∞] ==============================================

async def profile(msg: types.Message):
    checkers = bd.check_profile(id=msg.from_user.id)
    await bot.send_message(chat_id=msg.chat.id, text=f'''
<code>üìë –ë–æ—Ç –ú–∞—Ä–µ—Å–µ–µ–≤–∏—á / –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è </code>

–ò–º—è: {checkers[0]}
–°—Ç–∞—Ç—É—Å: {checkers[2]}
–ë–∞–ª–∞–Ω—Å: {checkers[1]} —Ä—É–±–ª–µ–π
–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {checkers[4]}

<b>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</b> ¬ª @raizyxadev
''', parse_mode='HTML')

# ["Attraction City"] ==============================================

async def create_attraction(msg: types.Message, state: FSMContext):
    if msg.from_user.id in config.owners_id:
        await bot.send_message(chat_id=msg.chat.id, text=f'{msg.chat.id}, –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏')
        Create_Item_Attractions.name.set()

async def add_url_attr(msg: types.Message, state: FSMContext):
    await state.update_data(name=msg.text)
    await bot.send_message(chat_id=msg.chat.id, text=f'–•–æ—Ä–æ—à–æ, —Ç–µ–ø–µ—Ä—å –∫–∏–Ω—å—Ç–µ –º–Ω–µ —Å—Å—ã–ª–∫—É –Ω–∞ –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ Google –∏–ª–∏ –Ø–Ω–¥–µ–∫—Å')
    await Create_Item_Attractions.next()

def register_handlers(dp : Dispatcher):
    dp.register_message_handler(faqinfo, text="üìî F.A.Q")
    dp.register_message_handler(supportOpen, text="üéß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞")
    dp.register_message_handler(welcome, commands=['start'])
    dp.register_message_handler(attractioncity, text="üïå –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫—Ä–∞—è")
    dp.register_message_handler(profile, text=['üéß –ü—Ä–æ—Ñ–∏–ª—å'])
    dp.register_message_handler(create_attraction, text=['–î–æ–±–∞–≤–∏—Ç—å –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å'])
    dp.register_callback_query_handler(add_url_attr, state= Create_Item_Attractions.name)